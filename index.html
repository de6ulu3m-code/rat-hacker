<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RatOS: Blackout</title>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; touch-action: none; }
        canvas { display: block; filter: sepia(0.5) contrast(1.5); }
        .hud { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; pointer-events: none; font-size: 14px; }
        .battery-bg { width: 100px; height: 15px; border: 1px solid #0f0; }
        #battery-fill { height: 100%; background: #0f0; width: 100%; transition: 0.2s; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; }
        .btn { width: 80px; height: 80px; border: 1px solid #0f0; display: flex; align-items: center; justify-content: center; background: rgba(0, 255, 0, 0.1); color: #0f0; font-weight: bold; border-radius: 5px; }
        .btn:active { background: #0f0; color: #000; }
        #terminal { display: none; position: absolute; top: 20%; left: 10%; right: 10%; bottom: 40%; background: #050505; border: 2px solid #0f0; padding: 20px; z-index: 100; }
    </style>
</head>
<body>

<div class="hud">
    <div>ENERGY: <div class="battery-bg"><div id="battery-fill"></div></div></div>
    <div>DOOR: <span id="door-num">01</span></div>
</div>

<div id="terminal">
    <div>[–°–ò–°–¢–ï–ú–ê –í–ó–õ–û–ú–ê]</div>
    <div id="term-quest" style="margin: 20px 0;">–í–í–ï–î–ò–¢–ï –ß–ê–°–¢–û–¢–£...</div>
    <input type="number" id="term-input" style="background:#000; color:#0f0; border:1px solid #0f0; width:100%; font-size:20px;">
    <button onclick="tryUnlock()" style="margin-top:20px; width:100%; background:#0f0; border:none; padding:10px;">–í–ó–õ–û–ú–ê–¢–¨</button>
</div>

<canvas id="game"></canvas>

<div class="controls">
    <div class="btn" id="move">WALK</div>
    <div class="btn" id="light">LIGHT</div>
    <div class="btn" id="interact">USE</div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let state = {
        door: 1,
        energy: 100,
        lightOn: false,
        playerPos: { x: 50, y: canvas.height/2 },
        termPos: { x: canvas.width - 80, y: canvas.height/2 },
        monster: { active: false, x: 0, speed: 0 },
        isMoving: false,
        glitchMode: false
    };

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    document.getElementById('light').ontouchstart = () => state.lightOn = !state.lightOn;
    document.getElementById('move').ontouchstart = () => state.isMoving = true;
    document.getElementById('move').ontouchend = () => state.isMoving = false;
    document.getElementById('interact').ontouchstart = () => {
        if (Math.hypot(state.playerPos.x - state.termPos.x, state.playerPos.y - state.termPos.y) < 60) {
            openTerminal();
        }
    };

    let targetCode = 0;
    function openTerminal() {
        targetCode = Math.floor(100 + Math.random() * 800);
        document.getElementById('term-quest').innerText = "–¢–†–ï–ë–£–ï–ú–ê–Ø –ß–ê–°–¢–û–¢–ê: " + (targetCode - 10) + " + 10";
        document.getElementById('terminal').style.display = 'block';
    }

    function tryUnlock() {
        let val = document.getElementById('term-input').value;
        if (parseInt(val) === targetCode) {
            state.door++;
            document.getElementById('terminal').style.display = 'none';
            document.getElementById('term-input').value = "";
            nextRoom();
        }
    }

    function nextRoom() {
        state.playerPos.x = 50;
        state.energy = Math.min(100, state.energy + 20);
        document.getElementById('door-num').innerText = state.door < 10 ? "0"+state.door : state.door;
        if (Math.random() > 0.5) triggerMonster();
    }

    function triggerMonster() {
        state.monster.active = true;
        state.monster.x = -200;
        state.monster.speed = 5 + state.door;
    }

    function update() {
        if (state.isMoving) state.playerPos.x += 3;
        
        if (state.lightOn) {
            state.energy -= 0.15;
            if (state.energy <= 0) state.lightOn = false;
        }

        if (state.monster.active) {
            state.monster.x += state.monster.speed;
            if (state.monster.x > canvas.width + 200) state.monster.active = false;
            // –ï—Å–ª–∏ –º–æ–Ω—Å—Ç—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç, –∞ —Å–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω ‚Äî —Å–º–µ—Ä—Ç—å
            if (Math.abs(state.monster.x - state.playerPos.x) < 100 && state.lightOn) {
                die("–û–ù–û –£–í–ò–î–ï–õ–û –°–í–ï–¢...");
            }
        }

        document.getElementById('battery-fill').style.width = state.energy + "%";
        if (state.energy < 20) state.glitchMode = true; else state.glitchMode = false;
    }

    function die(msg) {
        alert(msg);
        location.reload();
    }

    function draw() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
        ctx.strokeStyle = '#0f0';
        ctx.strokeRect(state.termPos.x - 20, state.termPos.y - 20, 40, 40);
        ctx.fillText("TERMINAL", state.termPos.x - 30, state.termPos.y - 30);

        // –°–≤–µ—Ç
        if (state.lightOn) {
            let g = ctx.createRadialGradient(state.playerPos.x, state.playerPos.y, 0, state.playerPos.x, state.playerPos.y, 180);
            g.addColorStop(0, 'rgba(0, 255, 0, 0.2)');
            g.addColorStop(1, 'transparent');
            ctx.fillStyle = g;
            ctx.beginPath();
            ctx.arc(state.playerPos.x, state.playerPos.y, 180, 0, Math.PI*2);
            ctx.fill();
        }

        // –ò–≥—Ä–æ–∫
        ctx.fillStyle = '#0f0';
        ctx.font = "30px Arial";
        ctx.fillText("üêÄ", state.playerPos.x - 15, state.playerPos.y + 15);

        // –ú–æ–Ω—Å—Ç—Ä (–ø—Ä–æ–ª–µ—Ç–∞–µ—Ç —Ç–µ–Ω—å—é)
        if (state.monster.active) {
            ctx.fillStyle = 'rgba(0, 255, 0, 0.05)';
            ctx.fillRect(state.monster.x - 50, 0, 100, canvas.height);
            if (Math.random() > 0.8) {
                ctx.fillStyle = '#0f0';
                ctx.fillText("ERR_ENTITY_Detected", state.monster.x, canvas.height/2);
            }
        }

        if (state.glitchMode && Math.random() > 0.9) {
            ctx.fillStyle = 'rgba(0, 255, 0, 0.1)';
            ctx.fillRect(0, Math.random()*canvas.height, canvas.width, 2);
        }
    }

    setInterval(() => { update(); draw(); }, 1000/60);
</script>
</body>
</html>
