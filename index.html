<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RAT DOORS: HARDCORE</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', monospace; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: #444; font-size: 1.2rem; pointer-events: none; }
        .btns { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; }
        .btn { width: 80px; height: 80px; border: 2px solid #333; border-radius: 10px; color: #333; display: flex; align-items: center; justify-content: center; font-weight: bold; background: rgba(0,0,0,0.5); }
        .btn:active { border-color: #fff; color: #fff; background: #222; }
    </style>
</head>
<body>

<div id="ui">–ö–û–ú–ù–ê–¢–ê: <span id="room">1</span></div>
<canvas id="game"></canvas>

<div class="btns">
    <div class="btn" id="l">‚¨ÖÔ∏è</div>
    <div class="btn" id="hide">–®–ö–ê–§</div>
    <div class="btn" id="r">‚û°Ô∏è</div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let room = 1;
    let player = { x: canvas.width/2, y: canvas.height-100, hiding: false, light: 150 };
    let lever = { x: 0, y: 0, pulled: false };
    let entity = { active: false, y: -100, speed: 30 };
    let traps = [];
    let keys = { l: false, r: false };

    function initRoom() {
        player.x = canvas.width/2;
        player.y = canvas.height-100;
        player.hiding = false;
        lever = { x: 50 + Math.random()*(canvas.width-100), y: 150 + Math.random()*(canvas.height-400), pulled: false };
        traps = [];
        for(let i=0; i<3; i++) traps.push({x: Math.random()*canvas.width, y: 200 + Math.random()*(canvas.height-400)});
        if(Math.random() > 0.6) setTimeout(spawnA60, 2000 + Math.random()*3000);
    }

    function spawnA60() {
        entity.active = true;
        entity.y = -500;
    }

    document.getElementById('l').ontouchstart = () => keys.l = true;
    document.getElementById('l').ontouchend = () => keys.l = false;
    document.getElementById('r').ontouchstart = () => keys.r = true;
    document.getElementById('r').ontouchend = () => keys.r = false;
    document.getElementById('hide').ontouchstart = () => player.hiding = !player.hiding;

    function update() {
        if (!player.hiding) {
            if (keys.l) player.x -= 5;
            if (keys.r) player.x += 5;
            player.y -= 2; // –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥ (–∫–∞–∫ –≤ Doors)
        }

        // –†—ã—á–∞–≥
        if (Math.hypot(player.x - lever.x, player.y - lever.y) < 40) lever.pulled = true;

        // –ö–∞–ø–∫–∞–Ω—ã
        traps.forEach(t => {
            if (Math.hypot(player.x - t.x, player.y - t.y) < 30 && !player.hiding) {
                player.y += 5; // –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ
            }
        });

        // –ê-60 (–ú–æ–Ω—Å—Ç—Ä)
        if (entity.active) {
            entity.y += entity.speed;
            if (Math.abs(entity.y - player.y) < 50 && !player.hiding) die("A-60 –°–¢–ï–† –¢–ï–ë–Ø");
            if (entity.y > canvas.height + 500) entity.active = false;
        }

        if (player.y < 50) {
            if (lever.pulled) { room++; initRoom(); }
            else player.y = 50;
        }

        if (player.x < 0 || player.x > canvas.width) player.x = Math.max(0, Math.min(canvas.width, player.x));
        document.getElementById('room').innerText = room;
    }

    function die(msg) {
        alert(msg);
        room = 1;
        initRoom();
    }

    function draw() {
        // –¢–ï–ú–ù–û–¢–ê
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –§–û–ù–ê–†–ò–ö
        let grd = ctx.createRadialGradient(player.x, player.y, 20, player.x, player.y, player.light);
        grd.addColorStop(0, 'rgba(255, 255, 200, 0.3)');
        grd.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = grd;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –û–ë–™–ï–ö–¢–´ (–≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Å–≤–µ—Ç–µ)
        if (Math.hypot(player.x - lever.x, player.y - lever.y) < player.light) {
            ctx.fillStyle = lever.pulled ? '#0f0' : '#f00';
            ctx.fillRect(lever.x-10, lever.y-10, 20, 20);
            ctx.fillStyle = '#fff';
            ctx.fillText("–†–´–ß–ê–ì", lever.x-20, lever.y-20);
        }

        // –ò–ì–†–û–ö
        ctx.font = "30px Arial";
        ctx.fillText(player.hiding ? "üö™" : "üêÄ", player.x-15, player.y+15);

        // –ú–û–ù–°–¢–† A-60
        if (entity.active) {
            ctx.fillStyle = '#f00';
            ctx.shadowBlur = 30; ctx.shadowColor = 'red';
            ctx.fillText("üëπ", player.x + (Math.random()*20-10), entity.y);
            ctx.shadowBlur = 0;
        }

        // –î–í–ï–†–¨
        ctx.strokeStyle = lever.pulled ? '#0f0' : '#333';
        ctx.strokeRect(canvas.width/2-50, 0, 100, 50);
    }

    initRoom();
    setInterval(() => { update(); draw(); }, 1000/60);
</script>
</body>
</html>
