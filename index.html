<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RatOS: Logic Escape</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; touch-action: none; text-align: center; }
        #screen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .door-panel { width: 300px; height: 400px; background: #333; border: 5px solid #555; border-radius: 10px; position: relative; padding: 20px; box-sizing: border-box; }
        .timer { font-size: 2rem; color: #f00; margin-bottom: 20px; font-weight: bold; }
        .hint { margin-top: 20px; color: #ffcc00; font-size: 1.2rem; }
        input { background: #000; border: 2px solid #0f0; color: #0f0; font-size: 2rem; width: 80%; text-align: center; outline: none; margin-top: 50px; }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .num-btn { background: #444; border: 2px solid #666; color: #fff; padding: 15px; font-size: 1.2rem; cursor: pointer; border-radius: 5px; }
        .num-btn:active { background: #0f0; color: #000; }
        #status-msg { margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div id="screen">
    <div class="timer">ГАЗ ЧЕРЕЗ: <span id="time">30</span>с</div>
    <div id="room-label">ДВЕРЬ №1</div>
    
    <div class="door-panel">
        <div id="puzzle-text" style="font-size: 1.2rem; margin-top: 20px;">ЗАДАЧА: 5 + 7 = ?</div>
        <input type="text" id="answer" readonly placeholder="????">
        
        <div class="numpad">
            <div class="num-btn" onclick="addNum(1)">1</div>
            <div class="num-btn" onclick="addNum(2)">2</div>
            <div class="num-btn" onclick="addNum(3)">3</div>
            <div class="num-btn" onclick="addNum(4)">4</div>
            <div class="num-btn" onclick="addNum(5)">5</div>
            <div class="num-btn" onclick="addNum(6)">6</div>
            <div class="num-btn" onclick="addNum(7)">7</div>
            <div class="num-btn" onclick="addNum(8)">8</div>
            <div class="num-btn" onclick="addNum(9)">9</div>
            <div class="num-btn" style="background:#800" onclick="clearAns()">C</div>
            <div class="num-btn" onclick="addNum(0)">0</div>
            <div class="num-btn" style="background:#080" onclick="checkAns()">OK</div>
        </div>
        <div id="status-msg"></div>
    </div>
    
    <div class="hint" id="hint-text">Введи ответ, чтобы открыть дверь!</div>
</div>

<script>
    let currentDoor = 1;
    let timeLeft = 30;
    let correctAnswer = "";
    let timerInterval;

    function startLevel() {
        clearInterval(timerInterval);
        timeLeft = Math.max(10, 35 - currentDoor); // С каждой дверью времени всё меньше!
        document.getElementById('time').innerText = timeLeft;
        document.getElementById('room-label').innerText = "ДВЕРЬ №" + currentDoor;
        document.getElementById('status-msg').innerText = "";
        document.getElementById('answer').value = "";
        
        generatePuzzle();
        
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('time').innerText = timeLeft;
            if (timeLeft <= 0) {
                gameOver();
            }
        }, 1000);
    }

    function generatePuzzle() {
        const type = Math.floor(Math.random() * 3);
        const pText = document.getElementById('puzzle-text');
        
        if (type === 0) { // Математика
            let a = Math.floor(Math.random() * 20 * (currentDoor/2));
            let b = Math.floor(Math.random() * 20 * (currentDoor/2));
            correctAnswer = (a + b).toString();
            pText.innerText = `РЕШИ: ${a} + ${b} = ?`;
        } else if (type === 1) { // Последовательность
            let start = Math.floor(Math.random() * 10);
            let step = Math.floor(Math.random() * 5) + 1;
            let seq = [start, start + step, start + step * 2];
            correctAnswer = (start + step * 3).toString();
            pText.innerText = `ПРОДОЛЖИ: ${seq.join(', ')}, ...?`;
        } else { // Память (быстрое мигание числа)
            let code = Math.floor(1000 + Math.random() * 9000).toString();
            correctAnswer = code;
            pText.innerText = "ЗАПОМНИ КОД!";
            setTimeout(() => { pText.innerText = code; }, 500);
            setTimeout(() => { pText.innerText = "ВВОДИ КОД!"; }, 1500);
        }
    }

    function addNum(n) {
        document.getElementById('answer').value += n;
    }

    function clearAns() {
        document.getElementById('answer').value = "";
    }

    function checkAns() {
        const val = document.getElementById('answer').value;
        if (val === correctAnswer) {
            currentDoor++;
            document.getElementById('status-msg').innerText = "ДВЕРЬ ОТКРЫТА!";
            document.getElementById('status-msg').style.color = "#0f0";
            setTimeout(startLevel, 1000);
        } else {
            document.getElementById('status-msg').innerText = "ОШИБКА!";
            document.getElementById('status-msg').style.color = "#f00";
            clearAns();
        }
    }

    function gameOver() {
        clearInterval(timerInterval);
        alert("ТЫ НЕ УСПЕЛ! Газ заполнил комнату. Твой результат: " + (currentDoor - 1) + " дверей.");
        currentDoor = 1;
        startLevel();
    }

    startLevel();
</script>
</body>
</html>
