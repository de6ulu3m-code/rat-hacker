<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOORS: RAT CHASE</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Arial', sans-serif; overflow: hidden; touch-action: none; user-select: none; }
        canvas { display: block; }
        .hud { position: absolute; top: 20px; width: 100%; text-align: center; font-size: 1.5rem; color: #f00; font-weight: bold; text-shadow: 0 0 10px #f00; z-index: 10; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; padding: 0 20px; box-sizing: border-box; }
        .btn { width: 80px; height: 80px; background: rgba(255,255,255,0.1); border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; }
        #jump { border-color: #0f0; color: #0f0; }
        #slide { border-color: #ff0; color: #ff0; }
    </style>
</head>
<body>

<div class="hud">–î–ò–°–¢–ê–ù–¶–ò–Ø: <span id="dist">0</span>–º</div>
<canvas id="game"></canvas>

<div class="controls">
    <div class="btn" id="left">‚¨ÖÔ∏è</div>
    <div class="btn" id="slide">‚¨áÔ∏è</div>
    <div class="btn" id="jump">üöÄ</div>
    <div class="btn" id="right">‚û°Ô∏è</div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let distance = 0;
    let speed = 6;
    let player = { x: canvas.width / 2, y: canvas.height - 150, w: 50, h: 50, dy: 0, state: 'run' };
    let obstacles = [];
    let seekY = canvas.height + 200; // –ü–æ–∑–∏—Ü–∏—è –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è (–≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞)
    let shake = 0;

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    const input = { left: false, right: false };
    document.getElementById('left').ontouchstart = () => input.left = true;
    document.getElementById('left').ontouchend = () => input.left = false;
    document.getElementById('right').ontouchstart = () => input.right = true;
    document.getElementById('right').ontouchend = () => input.right = false;
    document.getElementById('jump').ontouchstart = () => { if(player.y >= canvas.height - 150) player.dy = -15; };
    document.getElementById('slide').ontouchstart = () => { player.state = 'slide'; setTimeout(() => player.state = 'run', 600); };

    function spawnObstacle() {
        const types = ['jump', 'slide', 'door'];
        const type = types[Math.floor(Math.random() * types.length)];
        obstacles.push({
            x: Math.random() * (canvas.width - 100) + 50,
            y: -100,
            w: type === 'door' ? 80 : 120,
            h: 40,
            type: type
        });
    }

    setInterval(spawnObstacle, 1200);

    function update() {
        distance += 1;
        speed += 0.001; // –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        if (input.left) player.x -= 8;
        if (input.right) player.x += 8;
        player.x = Math.max(50, Math.min(canvas.width - 50, player.x));

        // –§–∏–∑–∏–∫–∞ –ø—Ä—ã–∂–∫–∞
        player.y += player.dy;
        player.dy += 0.8;
        if (player.y > canvas.height - 150) {
            player.y = canvas.height - 150;
            player.dy = 0;
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        obstacles.forEach((obs, i) => {
            obs.y += speed;

            // –ö–æ–ª–ª–∏–∑–∏–∏
            let hit = false;
            if (Math.abs(player.x - obs.x) < 50 && Math.abs(player.y - obs.y) < 40) {
                if (obs.type === 'jump' && player.y > canvas.height - 180) hit = true;
                if (obs.type === 'slide' && player.state !== 'slide') hit = true;
            }

            if (hit) {
                shake = 20;
                seekY -= 40; // –°–∏–∫ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ!
            }

            if (obs.y > canvas.height) obstacles.splice(i, 1);
        });

        // –°–∏–∫ (–ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å)
        seekY -= 0.1; 
        if (seekY < player.y + 50) die();

        if (shake > 0) shake--;
        document.getElementById('dist').innerText = Math.floor(distance / 10);
    }

    function die() {
        alert("–°–ò–ö –ü–û–ô–ú–ê–õ –¢–ï–ë–Ø! –¢–í–û–ô –†–ï–ö–û–†–î: " + Math.floor(distance/10) + "–º");
        location.reload();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
        if (shake > 0) {
            ctx.translate(Math.random()*10-5, Math.random()*10-5);
        }

        // –ö–æ—Ä–∏–¥–æ—Ä
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 10;
        ctx.strokeRect(40, -10, canvas.width - 80, canvas.height + 20);

        // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        obstacles.forEach(obs => {
            if (obs.type === 'jump') {
                ctx.fillStyle = '#f00';
                ctx.fillRect(obs.x - obs.w/2, obs.y, obs.w, obs.h);
                ctx.fillStyle = '#fff';
                ctx.fillText("–ü–ï–†–ï–ü–†–´–ì–ù–ò!", obs.x - 40, obs.y - 10);
            } else if (obs.type === 'slide') {
                ctx.fillStyle = '#ff0';
                ctx.fillRect(obs.x - obs.w/2, obs.y - 60, obs.w, 20);
                ctx.fillText("–ü–†–û–°–ö–û–õ–¨–ó–ù–ò!", obs.x - 50, obs.y - 80);
            }
        });

        // –ò–≥—Ä–æ–∫
        ctx.font = "40px Arial";
        let icon = player.state === 'slide' ? "ü•®" : "üêÄ";
        ctx.fillText(icon, player.x - 20, player.y + 20);

        // –°–∏–∫ (Seek)
        ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
        ctx.fillRect(0, seekY, canvas.width, 500);
        ctx.fillStyle = '#f00';
        ctx.font = "100px Arial";
        ctx.fillText("üëÅÔ∏è", canvas.width/2 - 50, seekY + 100);

        ctx.setTransform(1, 0, 0, 1, 0, 0); // –°–±—Ä–æ—Å —Ç—Ä—è—Å–∫–∏
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }
    loop();
</script>
</body>
</html>
