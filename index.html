<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RatOS: BOSS RUSH</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; touch-action: none; user-select: none; }
        canvas { display: block; }
        .ui { position: absolute; top: 10px; width: 100%; text-align: center; font-size: 1.5rem; color: #ff4444; text-shadow: 2px 2px #000; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-around; padding: 0 10px; box-sizing: border-box; }
        .btn { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        #hp-bar { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); width: 80%; height: 20px; background: #333; border: 2px solid #fff; }
        #hp-fill { width: 100%; height: 100%; background: #f00; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="ui">BOSS: –ú–ï–ì–ê-–ü–´–õ–ï–°–û–°</div>
<div id="hp-bar"><div id="hp-fill"></div></div>

<canvas id="game"></canvas>

<div class="controls">
    <div class="btn" id="left">‚¨ÖÔ∏è</div>
    <div class="btn" id="right">‚û°Ô∏è</div>
    <div class="btn" id="jump">üöÄ</div>
    <div class="btn" id="fire" style="background: rgba(255,0,0,0.3)">üî•</div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let player = { x: 100, y: canvas.height-100, w: 40, h: 40, dy: 0, hp: 100, jumping: false };
    let boss = { x: canvas.width-200, y: canvas.height-250, w: 180, h: 200, hp: 1000, maxHp: 1000, state: 'idle', timer: 0 };
    let bullets = [];
    let bossProjectiles = [];
    let keys = { left: false, right: false };

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    const setupBtn = (id, key) => {
        const btn = document.getElementById(id);
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); if(id === 'jump') jump(); else if(id === 'fire') shoot(); else keys[id] = true; });
        btn.addEventListener('touchend', () => { if(id !== 'jump' && id !== 'fire') keys[id] = false; });
    };
    ['left', 'right', 'jump', 'fire'].forEach(setupBtn);

    function jump() { if (!player.jumping) { player.dy = -18; player.jumping = true; } }
    function shoot() { bullets.push({ x: player.x + 40, y: player.y + 20, vx: 10 }); }

    function update() {
        // –ò–≥—Ä–æ–∫
        if (keys.left) player.x -= 7;
        if (keys.right) player.x += 7;
        player.dy += 0.8;
        player.y += player.dy;
        if (player.y > canvas.height - 100) { player.y = canvas.height - 100; player.dy = 0; player.jumping = false; }

        // –ë–æ—Å—Å –ò–ò
        boss.timer++;
        if (boss.timer % 120 === 0) {
            const r = Math.random();
            if (r < 0.3) boss.state = 'shoot';
            else if (r < 0.6) boss.state = 'vacuum';
            else boss.state = 'laser';
        }

        if (boss.state === 'shoot' && boss.timer % 20 === 0) {
            bossProjectiles.push({ x: boss.x, y: boss.y + 100, vx: -8, vy: (Math.random()-0.5)*5, type: 'trash' });
        }
        if (boss.state === 'vacuum') {
            player.x += 3; // –ó–∞—Å–∞—Å—ã–≤–∞–µ—Ç
        }

        // –ü—É–ª–∏ –∏–≥—Ä–æ–∫–∞
        bullets.forEach((b, i) => {
            b.x += b.vx;
            if (b.x > boss.x && b.y > boss.y && b.y < boss.y + boss.h) {
                boss.hp -= 5;
                bullets.splice(i, 1);
            }
        });

        // –°–Ω–∞—Ä—è–¥—ã –±–æ—Å—Å–∞
        bossProjectiles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy;
            if (Math.hypot(p.x - player.x, p.y - player.y) < 30) {
                player.hp -= 10;
                bossProjectiles.splice(i, 1);
            }
        });

        document.getElementById('hp-fill').style.width = (boss.hp / boss.maxHp * 100) + '%';
        if (player.hp <= 0) { alert('–ü–´–õ–ï–°–û–° –ü–û–ë–ï–î–ò–õ...'); location.reload(); }
        if (boss.hp <= 0) { alert('–ü–û–ë–ï–î–ê! –ü–ï–ù–¢–•–ê–£–° –°–í–û–ë–û–î–ï–ù!'); location.reload(); }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –ü–æ–ª
        ctx.fillStyle = '#222';
        ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

        // –ò–≥—Ä–æ–∫
        ctx.font = "40px Arial";
        ctx.fillText("üêÄ", player.x, player.y + 30);

        // –ë–æ—Å—Å
        ctx.font = "150px Arial";
        ctx.fillText("ü§ñ", boss.x, boss.y + 150);
        ctx.font = "20px Arial";
        ctx.fillStyle = "#fff";
        ctx.fillText("–†–ï–ñ–ò–ú: " + boss.state.toUpperCase(), boss.x, boss.y - 20);

        // –ü—É–ª–∏
        ctx.fillStyle = '#0f0';
        bullets.forEach(b => ctx.fillRect(b.x, b.y, 10, 4));
        ctx.fillStyle = '#ff0';
        bossProjectiles.forEach(p => ctx.fillText("üì¶", p.x, p.y));
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }
    loop();
</script>
</body>
</html>
