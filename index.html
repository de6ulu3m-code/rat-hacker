<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RatOS: Sandbox</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: #eee; font-family: sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; background: #000; }
        .toolbar { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; padding: 10px; gap: 10px; flex-wrap: wrap; }
        button { background: #333; color: #fff; border: 1px solid #555; padding: 10px; cursor: pointer; border-radius: 5px; font-size: 14px; }
        button:active { background: #ffcc00; color: #000; }
        .stats { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; pointer-events: none; }
    </style>
</head>
<body>

<div class="stats">–°–´–†: <span id="cheese">0</span> üßÄ | –û–ë–™–ï–ö–¢–û–í: <span id="obj-count">0</span></div>

<canvas id="canvas"></canvas>

<div class="toolbar">
    <button onclick="setMode('rat')">üêÄ –°–ü–ê–í–ù –ö–†–´–°–´</button>
    <button onclick="setMode('cat')">üòº –°–ü–ê–í–ù –ö–û–¢–ê</button>
    <button onclick="setMode('cheese')">üßÄ –ö–ò–î–ê–¢–¨ –°–´–†</button>
    <button onclick="explodeAll()" style="background: #800;">üí• –ë–ê–ë–ê–•!</button>
    <button onclick="clearAll()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨</button>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let cheeseCount = parseInt(localStorage.getItem('ratCheese')) || 0;
    let mode = 'rat';
    let objects = [];

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    function setMode(m) { mode = m; }

    class Entity {
        constructor(x, y, type) {
            this.x = x; this.y = y; this.type = type;
            this.vx = (Math.random() - 0.5) * 10;
            this.vy = (Math.random() - 0.5) * 10;
            this.size = type === 'cheese' ? 20 : 40;
            this.life = 100;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            
            // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
            objects.forEach(other => {
                if (other === this) return;
                let d = Math.hypot(this.x - other.x, this.y - other.y);
                if (d < this.size) {
                    if (this.type === 'rat' && other.type === 'cheese') {
                        other.life = 0; cheeseCount += 10;
                    }
                    if (this.type === 'cat' && other.type === 'rat') {
                        this.vx *= 1.1; other.life -= 1;
                    }
                }
            });
        }
        draw() {
            ctx.font = this.size + "px Arial";
            let icon = this.type === 'rat' ? "üêÄ" : (this.type === 'cat' ? "üòº" : "üßÄ");
            ctx.fillText(icon, this.x - this.size/2, this.y + this.size/2);
        }
    }

    canvas.addEventListener('mousedown', (e) => {
        for(let i=0; i<5; i++) objects.push(new Entity(e.clientX, e.clientY, mode));
    });

    function explodeAll() {
        objects.forEach(obj => {
            obj.vx *= 5; obj.vy *= 5;
            if (obj.type !== 'cheese') cheeseCount += 5;
        });
        setTimeout(() => { objects = []; }, 500);
    }

    function clearAll() { objects = []; }

    function loop() {
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0,0, canvas.width, canvas.height);
        
        objects = objects.filter(o => o.life > 0);
        objects.forEach(o => { o.update(); o.draw(); });
        
        document.getElementById('cheese').innerText = cheeseCount;
        document.getElementById('obj-count').innerText = objects.length;
        localStorage.setItem('ratCheese', cheeseCount);
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
